
#region--header-menu {
  nav {

    // Extend the menu to the edge of screen on mobile, and line up the text on desktop.
    margin: 0 -#{$container-padding};

    // Add space between menus in the mobile drawer.
    & + nav {
      margin-top: $container-padding * 2;
    }

    // Have a background color for the main menu.
    ul {
      background: color(main-menu-background);
    }

    // Fill in the areas to the left and the right of the main menu bar with the background color.
    @include breakpoint(large) {
      position: relative;
      &::before, &::after {
        content: "";
        position: absolute;
        width: calc(50vw - #{$container-width} / 2 - #{$container-padding});
        height: 100%;
        background: color(main-menu-background);
        top: 0;
      }
      &::before { right: 100%; }
      &::after { left: 100%; }
    }

    // Add lines between all menu items on mobile, and in the dropdowns on desktop;
    li {
      border-top: 1px solid color(background-body);
      @include breakpoint(large) {
        border-top: 0;
        li + li {
          border-top: 1px solid color(off-white);
        }
        // Add a line around the dropdown in case of menu overlap.
        ul {
          box-shadow: 0px 0px 1px 1px color(off-white);
        }
      }
    }

    // Common menu link styles.
    a {
      display: block;
      height: 100%;
      color: color(main-menu-text);
      font-weight: bold;
      text-decoration: none;
      &:hover, &:focus {
        outline-offset: -1px;
        background: color(main-menu-hover);
      }
      padding: $container-padding;
      // Leave room for the submenu toggle on mobile.
      padding-right: calc(#{$container-padding} * 2 + 2em);
      @include breakpoint(large) {
        padding: 1em #{$container-padding};
      }
    }

    // On desktop, keep the parent item hover color when over dropdowns.
    li:hover, li:focus-within {
      @include breakpoint(large) {
        background: color(main-menu-hover);
      }
    }

    // Make subitems a normal font weight.
    ul ul a {
      font-weight: normal;
    }

    // Hide sub-items to start. Give dropdowns the menu background on desktop;
    ul ul {
      display: none;
      background: rgba(255,255,255,.5);
      @include breakpoint(large) {
        background: color(main-menu-background);
      }
    }

    // On desktop, show the menu items side-by-side and wrap if there isn't enough room.
    @include breakpoint(large) {
      > ul {
        display: flex;
        flex-wrap: wrap;
        > li {
          position: relative;
          ul {
            position: absolute;
            z-index: 100;
            top: calc(100% + 1px);
            left: 0;
            left: var(--shift-left);
            width: 20em;
             ul {
              display: none;
            }
            display: none;
          }
          // Show dropdowns on hover, or when expanded with the keyboard.
          &:hover > ul {
            display: block;
          }
          // Class set by js to keep dropdowns from extending past the edge of the window.
          &.dropdown-align-right {
            ul {
              right: 0;
              left: auto;
            }
          }
        }
      }
    }

    // The mobile submenu toggle button.
    li {
      position: relative;
      button.header-menu-toggle {
        position: absolute;
        top: 0;
        right: 0;
        padding: $container-padding / 2 $container-padding;
        border: 0;
        background: transparent;
        svg {
          background: rgba(255, 255, 255, .5);
          border-radius: .5em;
          border: 1.5px solid transparent;
          box-sizing: content-box;
          padding: $container-padding / 2;
        }
        &:hover {
          svg {
            background: color(main-menu-hover);
          }
        }
        &:focus {
          outline: 0;
          svg {
            border-color: color(main-menu-text);
          }
        }
        &[aria-expanded="true"] {
          svg {
            transform: rotate(180deg);
          }
          & + ul {
            display: block;
          }
        }
        @include breakpoint(large) {
          display: none;
        }
      }
    }

    // Don't leave dropdowns open on desktop if there is no hover and no focus within them.
    @include breakpoint(large) {
      li:not(:focus-within):not(:hover) button.header-menu-toggle + ul {
        display: none;
      }
    }

    // On desktop, only show the menu toggles next to the menu item when focus is within the menu.
    @include breakpoint(large) {
      &:focus-within:not([data-mouse-click="true"]) {
        > ul > li {
          padding-right: 2em;
          a {
            padding: 1em .5em 1em .5em;
          }
        }
        button.header-menu-toggle {
          display: block;
          padding: 0;
          svg {
            padding: 1em .5em;
            background: none;
            border-width: 1px;
            border-radius: 0;
          }
        }
      }
    }


    // Style the any additional menus that are added to the mobile drawer.
    &:not(:first-child) {
      @include breakpoint(large) {
        display: none;
      }
      ul {
        background: color(mobile-menu-background);
      }
      li:hover > a {
        background: color(mobile-menu-hover);
      }
      a {
        color: color(mobile-menu-text);
      }
    }
  }
}
